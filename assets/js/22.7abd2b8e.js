(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{303:function(t,a,s){"use strict";s.r(a);var e=s(14),r=Object(e.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"mysql"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mysql"}},[t._v("#")]),t._v(" Mysql")]),t._v(" "),a("h2",{attrs:{id:"一、数据库三范式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一、数据库三范式"}},[t._v("#")]),t._v(" 一、数据库三范式")]),t._v(" "),a("ol",[a("li",[t._v("第一范式：\n"),a("ul",[a("li",[t._v("原子性：表中字段的数据，不可以再拆分。")]),t._v(" "),a("li",[t._v("通常第一范式可以用主键实现。")])])])]),t._v(" "),a("h2",{attrs:{id:"二、索引"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二、索引"}},[t._v("#")]),t._v(" 二、索引")]),t._v(" "),a("h3",{attrs:{id:"_1-索引的类型-五种类型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-索引的类型-五种类型"}},[t._v("#")]),t._v(" 1. 索引的类型（五种类型）")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("普通索引")]),t._v(" "),a("ul",[a("li",[t._v("允许空值和重复值。")])])]),t._v(" "),a("li",[a("p",[t._v("唯一索引")]),t._v(" "),a("ul",[a("li",[t._v("唯一索引与普通索引的区别：唯一索引所在列值不允许重复。")])])]),t._v(" "),a("li",[a("p",[t._v("主键索引（特殊的唯一索引）")]),t._v(" "),a("ul",[a("li",[t._v("特殊的唯一索引，不允许有空值。")]),t._v(" "),a("li",[t._v("b+树中，主键索引在叶子节点里，存放的是整行数据。")])])]),t._v(" "),a("li",[a("p",[t._v("联合索引")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("在多个字段上创建索引，使用时遵循最左前缀原则")])]),t._v(" "),a("li",[a("p",[t._v("联合索引的最左前缀原则")]),t._v(" "),a("ul",[a("li",[t._v("最左前缀举例\n"),a("ul",[a("li",[t._v("创建了一个包含三列的联合索引"),a("code",[t._v("(col1, col2, col3)")]),t._v("，索引生效于"),a("code",[t._v("(col1), (col1, col2), and (col1, col2, col3)")]),t._v("。")])])])])])])]),t._v(" "),a("li",[a("p",[t._v("空间索引")])])]),t._v(" "),a("h3",{attrs:{id:"_6-聚集-簇-索引与非聚集-簇-索引"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-聚集-簇-索引与非聚集-簇-索引"}},[t._v("#")]),t._v(" 6. 聚集（簇）索引与非聚集（簇）索引")]),t._v(" "),a("h4",{attrs:{id:"聚集索引"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#聚集索引"}},[t._v("#")]),t._v(" 聚集索引")]),t._v(" "),a("ul",[a("li",[t._v("InnoDB中，主键索引又被称为聚集索引"),a("code",[t._v("（clustered index）")]),t._v("。")])]),t._v(" "),a("h4",{attrs:{id:"回表"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#回表"}},[t._v("#")]),t._v(" 回表")]),t._v(" "),a("p",[t._v("什么是回表?")]),t._v(" "),a("p",[t._v("因为"),a("code",[t._v("非主键索引")]),t._v("叶子节点存的是"),a("code",[t._v("主键")]),t._v("的值。所以在同时存在主键索引与非主键索引的表中，where字句的条件是非主键索引时，会通过该"),a("code",[t._v("非主键索引")]),t._v("的索引树（b+树）查找到对应"),a("code",[t._v("主键的值")]),t._v("，再\n通过"),a("code",[t._v("主键的值")]),t._v("查找"),a("code",[t._v("主键索引")]),t._v("对应的索引树，从而查出整行数据。该过程称为"),a("code",[t._v("回表")]),t._v("。")]),t._v(" "),a("p",[t._v("回表举例：")]),t._v(" "),a("ul",[a("li",[t._v("建表")])]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("create")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("table")]),t._v(" A"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    id "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("primary")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("key")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("not")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    name "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("char")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("not")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n")])])]),a("h3",{attrs:{id:"_4"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4"}},[t._v("#")]),t._v(" 4.")]),t._v(" "),a("h3",{attrs:{id:"_2-索引的底层结构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-索引的底层结构"}},[t._v("#")]),t._v(" 2. 索引的底层结构")]),t._v(" "),a("h4",{attrs:{id:"b-树"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#b-树"}},[t._v("#")]),t._v(" B+树")]),t._v(" "),a("p",[t._v("Innodb使用b+树")]),t._v(" "),a("ul",[a("li",[t._v("b+树中，主键索引在叶子节点里，存放的是整行数据。")]),t._v(" "),a("li",[t._v("b+树中，非主键索引叶子节点存的是主键的值。InnoDB中，非主键索引也叫做二级索引（secondary index）。")])]),t._v(" "),a("h3",{attrs:{id:"_3-如何创建与删除索引"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-如何创建与删除索引"}},[t._v("#")]),t._v(" 3. 如何创建与删除索引")]),t._v(" "),a("h4",{attrs:{id:"_3-1-创建普通索引-三种方式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-创建普通索引-三种方式"}},[t._v("#")]),t._v(" 3.1 创建普通索引（三种方式）")]),t._v(" "),a("ol",[a("li",[t._v("建表时创建索引")])]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CREATE")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("TABLE")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token identifier"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("table_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("  \n"),a("span",{pre:!0,attrs:{class:"token identifier"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("11")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("AUTO_INCREMENT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  \n"),a("span",{pre:!0,attrs:{class:"token identifier"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("char")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("255")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  \n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("PRIMARY")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("KEY")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token identifier"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  \n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("INDEX")]),t._v(" index_name "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ENGINE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("InnoDB")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DEFAULT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CHARSET")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("utf8mb4"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  \n")])])]),a("ol",{attrs:{start:"2"}},[a("li",[t._v("使用"),a("code",[t._v("create index")]),t._v("直接创建")])]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CREATE")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("INDEX")]),t._v(" index_name "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ON")]),t._v(" table_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("column_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("ol",{attrs:{start:"3"}},[a("li",[t._v("使用"),a("code",[t._v("alter table")]),t._v("以修改表结构的方式添加索引")])]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ALTER")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("TABLE")]),t._v(" table_name "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ADD")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("INDEX")]),t._v(" index_name "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ON")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("column_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" \n")])])]),a("h4",{attrs:{id:"_3-2-创建唯一索引"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-创建唯一索引"}},[t._v("#")]),t._v(" 3.2 创建唯一索引")]),t._v(" "),a("ul",[a("li",[t._v("创建唯一索引时，使用"),a("code",[t._v("UNIQUE")]),t._v("参数进行约束")])]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CREATE")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("TABLE")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token identifier"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("table_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("  \n"),a("span",{pre:!0,attrs:{class:"token identifier"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("11")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("AUTO_INCREMENT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("primary")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("key")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  \n"),a("span",{pre:!0,attrs:{class:"token identifier"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("char")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("255")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  \n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("UNIQUE")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("INDEX")]),t._v(" index_name "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ENGINE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("InnoDB")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DEFAULT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CHARSET")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("utf8mb4"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  \n\nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CREATE")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("table")]),t._v(" address"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" id  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("11")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("auto_increment")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("primary")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("key")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("not")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" name  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("varchar")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("50")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" address  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("varchar")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("UNIQUE")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("INDEX")]),t._v("  address"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("id  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ASC")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n")])])]),a("h4",{attrs:{id:"_3-2-创建主键索引"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-创建主键索引"}},[t._v("#")]),t._v(" 3.2 创建主键索引")]),t._v(" "),a("h4",{attrs:{id:"_3-2-创建联合索引"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-创建联合索引"}},[t._v("#")]),t._v(" 3.2 创建联合索引")]),t._v(" "),a("h4",{attrs:{id:"_3-5-如何删除索引"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-5-如何删除索引"}},[t._v("#")]),t._v(" 3.5 如何删除索引")]),t._v(" "),a("p",[a("code",[t._v("DROP INDEX index_name ON table_name;")])]),t._v(" "),a("h3",{attrs:{id:"_5-查看索引是否被引用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-查看索引是否被引用"}},[t._v("#")]),t._v(" 5. 查看索引是否被引用")]),t._v(" "),a("h2",{attrs:{id:"三、锁-悲观锁、乐观锁"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三、锁-悲观锁、乐观锁"}},[t._v("#")]),t._v(" 三、锁（悲观锁、乐观锁）")]),t._v(" "),a("h3",{attrs:{id:"_1-悲观锁-读锁、写锁"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-悲观锁-读锁、写锁"}},[t._v("#")]),t._v(" 1. 悲观锁（读锁、写锁）")]),t._v(" "),a("p",[t._v("悲观锁认为每次修改数据时，都会有其他线程来修改数据。")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("悲观锁分为"),a("code",[t._v("读锁")]),t._v("和"),a("code",[t._v("写锁")])])]),t._v(" "),a("li",[a("p",[t._v("sql语句使用 "),a("code",[t._v("for update")]),t._v(" 上悲观锁。")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("使用方法（用在select语句上）： "),a("code",[t._v("select * from table where id=1 for update")])])]),t._v(" "),a("li",[a("p",[t._v("注意："),a("code",[t._v("for update")]),t._v(" 仅适用于"),a("code",[t._v("InnoDB")]),t._v("，并且必须开启"),a("strong",[t._v("事务")]),t._v("，在"),a("code",[t._v("begin与commit")]),t._v("之间才生效。")])])])])]),t._v(" "),a("h4",{attrs:{id:"_1-1-读锁-共享锁-shared-lock"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-读锁-共享锁-shared-lock"}},[t._v("#")]),t._v(" 1.1 读锁（共享锁（shared lock））")]),t._v(" "),a("ul",[a("li",[t._v("多个事务共享一个锁，都可以访问数据。")]),t._v(" "),a("li",[t._v("只可读，不可修改数据。")])]),t._v(" "),a("h4",{attrs:{id:"_1-2-读锁-排他锁-exclusive-lock"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-读锁-排他锁-exclusive-lock"}},[t._v("#")]),t._v(" 1.2 读锁（排他锁（exclusive lock））")]),t._v(" "),a("ul",[a("li",[t._v("排他锁被一个事务获取后，该数据行无法被其他事务获取锁。")]),t._v(" "),a("li",[t._v("排他锁对数据可读可改。")])]),t._v(" "),a("p",[t._v("悲观锁总结：")]),t._v(" "),a("ul",[a("li",[t._v("悲观锁先锁定行数据，再进行访问。")]),t._v(" "),a("li",[t._v("优点：保证了数据的安全性")]),t._v(" "),a("li",[t._v("缺点：降低了并行性，增加了死锁的风险")])]),t._v(" "),a("h3",{attrs:{id:"_2-乐观锁"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-乐观锁"}},[t._v("#")]),t._v(" 2. 乐观锁")]),t._v(" "),a("p",[t._v("乐观锁在更新数据时，才进行加锁判断。\n适用与读多写少的场景。")]),t._v(" "),a("p",[t._v("乐观锁不需要借助数据库的锁机制。")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("乐观锁实现：")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("首先查询一遍数据，")])]),t._v(" "),a("li",[a("p",[t._v("在update之前，再次查询一遍数据，如果数据未改变，则update")])]),t._v(" "),a("li",[a("p",[t._v("常用方法是在表中增加一个字段version，每次更新使 version + 1，并在更新前后，且在version+1前都读取version来判断是否一致")])])])])]),t._v(" "),a("p",[t._v("乐观锁总结：")]),t._v(" "),a("ul",[a("li",[t._v("实现乐观锁两个步骤：\n"),a("ol",[a("li",[t._v("检测冲突。")]),t._v(" "),a("li",[t._v("数据更新。")])])])]),t._v(" "),a("h2",{attrs:{id:"锁的级别"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#锁的级别"}},[t._v("#")]),t._v(" 锁的级别")]),t._v(" "),a("p",[t._v("锁的级别分为行级锁和表级锁")]),t._v(" "),a("h3",{attrs:{id:"_1-行级锁"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-行级锁"}},[t._v("#")]),t._v(" 1. 行级锁")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("行级锁都是基于索引的。")])]),t._v(" "),a("li",[a("p",[t._v("如果一条 SQL 语句用不到索引是不会使用行级锁的，会使用表级锁把整张表锁住，这点需要注意。")])]),t._v(" "),a("li",[a("p",[t._v("InnoDB 默认行级锁。")])])]),t._v(" "),a("h3",{attrs:{id:"_2-表级锁"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-表级锁"}},[t._v("#")]),t._v(" 2. 表级锁")]),t._v(" "),a("h2",{attrs:{id:"事务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#事务"}},[t._v("#")]),t._v(" 事务")]),t._v(" "),a("h3",{attrs:{id:"_1-事务的隔离级别"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-事务的隔离级别"}},[t._v("#")]),t._v(" 1. 事务的隔离级别")]),t._v(" "),a("p",[t._v("4中隔离级别")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("读已提交")])]),t._v(" "),a("li",[a("p",[t._v("读未提交")]),t._v(" "),a("ul",[a("li",[t._v("也叫脏读")]),t._v(" "),a("li",[t._v("事务可以读取其他事务未提交的数据")])])]),t._v(" "),a("li",[a("p",[t._v("可重复读")]),t._v(" "),a("ul",[a("li",[t._v("mysql的默认隔离级别")])])]),t._v(" "),a("li",[a("p",[t._v("串行化")])]),t._v(" "),a("li",[a("p",[t._v("幻读")])])]),t._v(" "),a("p",[t._v("慢查询怎么看\n一条sql最多可以使用多少索引\nmvcc\n索引失效的情况\nsql慢如何查找\n微服务根据什么拆分\n服务遇到cpu飙高怎么处理\n服务限流和熔断怎么做\nredis哨兵机制\nredis分布式锁怎么实现\n什么是线程池\n秒杀会遇到什么问题怎么解决\n大量请求\n解决：\n限流\n削峰\n熔断\n服务降级")])])}),[],!1,null,null,null);a.default=r.exports}}]);