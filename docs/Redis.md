# Redis

## 如何保持redis与mysql数据一致性：

双删策略

1. 先删缓存
2. 再写入mysql
3. 等待时间（500ms），再删除缓存。

    - 此时删除的是写入mysql数据时，读行为在redis中产生的脏数据。产生的原因：第一次删除后，缓存中读不到数据，线程从mysql中将数据写入缓存，此时新数据还未写入mysql。

## redis事务
redis事务是一组命令的集合，redis事务是非原子性的
- 开始事务：使用`MULIT`开始事务，将后续命令放入队列中。
- 提交事务：使用`EXEC`提交事务，此时开始串行化执行队列中的命令。
- 非原子性：redis事务中命令是串行化执行，但事务整体不是原子性的。

事务其他命令：
- 取消事务：`DISCARD`，取消事务中的所有命令
- 监视事务中的key：`WATCH`，如果事务开始前，key被其他命令执行，则中断事务，不执行事务中的所有命令。
- 取消监视：`UNWATCH`